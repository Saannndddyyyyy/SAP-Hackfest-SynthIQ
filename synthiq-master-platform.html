<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SynthIQ ‚Äî Multi-Cluster Intelligence Suite</title>
    <link
        href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Syne:wght@400;500;600;700;800&family=IBM+Plex+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg: #050508;
            --surface: #0e0e15;
            --surface2: #14141e;
            --border: #242432;
            --accent: #7c6af7;
            --accent-glow: rgba(124, 106, 247, 0.4);
            --accent2: #f97316;
            --accent3: #22d3a5;
            --text: #f1f1f7;
            --muted: #6b6b8b;
            --danger: #f43f5e;
            --gold: #fbbf24;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Syne', sans-serif;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 9999;
            opacity: 0.3;
        }

        /* Top Progress Wizard */
        .wizard-header {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 20px 60px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo h1 {
            font-family: 'DM Serif Display', serif;
            font-size: 24px;
            background: linear-gradient(135deg, var(--accent), var(--accent3));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .step-indicator {
            display: flex;
            gap: 24px;
            position: relative;
        }

        .step {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--muted);
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .step.active {
            color: var(--text);
        }

        .step.completed {
            color: var(--accent3);
        }

        .step-num {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            background: var(--surface2);
        }

        .step.active .step-num {
            border-color: var(--accent);
            color: var(--accent);
            box-shadow: 0 0 8px var(--accent-glow);
        }

        .step.completed .step-num {
            background: var(--accent3);
            border-color: var(--accent3);
            color: var(--bg);
        }

        /* Main Viewport */
        .viewport {
            flex: 1;
            overflow-y: auto;
            padding: 40px 60px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .page {
            display: none;
            animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .page.active {
            display: block;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .title-block {
            margin-bottom: 40px;
        }

        .title-block h2 {
            font-family: 'DM Serif Display', serif;
            font-size: 40px;
            letter-spacing: -1px;
            margin-bottom: 8px;
        }

        .title-block p {
            color: var(--muted);
            font-size: 16px;
            max-width: 600px;
        }

        /* Component Cards */
        .grid {
            display: grid;
            gap: 20px;
            margin-bottom: 32px;
        }

        .grid-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .grid-2 {
            grid-template-columns: repeat(2, 1fr);
        }

        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            position: relative;
        }

        .card-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--muted);
            margin-bottom: 8px;
            font-weight: 800;
        }

        .card-val {
            font-family: 'DM Serif Display', serif;
            font-size: 28px;
            line-height: 1;
        }

        /* Comparison Badges */
        .badge-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 12px;
        }

        .badge {
            padding: 8px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 800;
            text-align: center;
            border: 1px solid var(--border);
        }

        .badge.pre {
            background: var(--surface2);
            color: var(--accent3);
        }

        .badge.post {
            background: var(--danger);
            color: #fff;
            opacity: 0.8;
        }

        /* Dashboard Chart */
        .dashboard-chart {
            display: flex;
            align-items: flex-end;
            gap: 12px;
            height: 200px;
            padding: 20px;
            background: var(--surface2);
            border-radius: 12px;
            margin-top: 20px;
            border: 1px solid var(--border);
        }

        .chart-bar-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100%;
            justify-content: flex-end;
        }

        .chart-bar {
            width: 100%;
            background: var(--muted);
            border-radius: 4px 4px 0 0;
            transition: all 1s cubic-bezier(0.16, 1, 0.3, 1);
            position: relative;
            cursor: pointer;
        }

        .chart-bar.winner {
            background: var(--accent);
            box-shadow: 0 0 15px var(--accent-glow);
        }

        .chart-bar:hover::after {
            content: attr(data-val) '%';
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            font-family: 'IBM Plex Mono';
            color: var(--text);
        }

        .chart-label {
            font-size: 7px;
            color: var(--muted);
            text-transform: uppercase;
            margin-top: 8px;
            text-align: center;
            font-weight: 800;
        }

        /* Log Styles */
        .log-container {
            background: #000;
            border: 1px solid var(--border);
            border-radius: 12px;
            height: 200px;
            padding: 12px;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 10px;
            overflow-y: auto;
            color: var(--accent3);
        }

        .log-line {
            margin-bottom: 8px;
            border-left: 3px solid transparent;
            padding-left: 10px;
            line-height: 1.4;
            border-radius: 0 4px 4px 0;
        }

        .log-line.shock {
            background: rgba(244, 63, 94, 0.05);
            color: var(--danger);
            border-color: var(--danger);
        }

        .log-line.personal {
            background: rgba(251, 191, 191, 0.1);
            color: var(--gold);
            border-color: var(--gold);
        }

        .log-line.cultural {
            background: rgba(124, 106, 247, 0.1);
            color: #a78bfa;
            border-color: #7c3aed;
        }

        .log-line small {
            display: block;
            color: rgba(255, 255, 255, 0.4);
            margin-top: 2px;
        }

        /* Final Report Modal */
        #final-report {
            display: none;
            position: fixed;
            inset: 0;
            background: var(--bg);
            z-index: 10001;
            padding: 40px 60px;
            overflow-y: auto;
        }

        /* Leaderboard */
        .leaderboard {
            width: 100%;
            border-collapse: collapse;
            margin-top: 12px;
        }

        .leaderboard th {
            text-align: left;
            font-size: 10px;
            color: var(--muted);
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
        }

        .leaderboard td {
            padding: 10px 0;
            font-size: 11px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .leaderboard .score {
            font-family: 'IBM Plex Mono';
            font-weight: 800;
        }

        .leaderboard .score.high {
            color: var(--accent3) !important;
        }

        /* Green */
        .leaderboard .score.mid {
            color: var(--gold) !important;
        }

        /* Yellow */
        .leaderboard .score.low {
            color: var(--danger) !important;
        }

        /* Red */

        .leaderboard .rep-tag {
            font-size: 8px;
            background: var(--surface2);
            padding: 2px 6px;
            border-radius: 4px;
            color: var(--muted);
            margin-left: 8px;
        }

        /* Mode Selector */
        .mode-selector {
            display: flex;
            gap: 16px;
            margin-bottom: 32px;
        }

        .mode-btn {
            flex: 1;
            padding: 20px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            text-align: left;
            transition: all 0.3s;
        }

        .mode-btn.active {
            border-color: var(--accent);
            background: var(--surface2);
            box-shadow: 0 0 20px var(--accent-glow);
        }

        .mode-btn h4 {
            font-family: 'DM Serif Display', serif;
            font-size: 18px;
            margin-bottom: 4px;
        }

        .mode-btn p {
            font-size: 11px;
            color: var(--muted);
        }

        /* Census Hub */
        .census-track {
            height: 32px;
            background: var(--surface2);
            border-radius: 8px;
            display: flex;
            overflow: hidden;
            margin: 16px 0;
            border: 1px solid var(--border);
        }

        .census-seg {
            height: 100%;
            transition: width 1s;
            cursor: pointer;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 10px;
            font-family: 'Syne', sans-serif;
            font-weight: 800;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: var(--accent);
            color: #fff;
        }

        .btn-secondary {
            background: var(--surface2);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .action-footer {
            background: rgba(14, 14, 21, 0.8);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--border);
            padding: 20px 60px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(5, 5, 8, 0.95);
            backdrop-filter: blur(20px);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .progress-bar {
            width: 400px;
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 20px;
        }

        .progress-fill {
            width: 0%;
            height: 100%;
            background: var(--accent);
            transition: width 0.3s;
        }

        textarea {
            background: var(--surface2);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 12px;
            border-radius: 8px;
            outline: none;
            font-family: 'Syne';
            font-size: 12px;
            resize: none;
            width: 100%;
        }

        /* Opportunity Card */
        .opp-card {
            background: linear-gradient(135deg, #14141e, #0e0e15);
            border: 1px solid var(--gold);
            border-radius: 16px;
            padding: 24px;
            position: relative;
            overflow: hidden;
        }

        .opp-card::after {
            content: 'CONVERSION TARGET';
            position: absolute;
            top: 12px;
            right: -30px;
            background: var(--gold);
            color: #000;
            font-size: 8px;
            font-weight: 900;
            padding: 4px 40px;
            transform: rotate(45deg);
        }

        .verbatim-text {
            font-family: 'Syne';
            font-size: 13px;
            line-height: 1.6;
            font-style: italic;
            color: var(--text);
        }

        .verbatim-author {
            margin-top: 12px;
            font-size: 9px;
            font-weight: 700;
            color: var(--accent3);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
    </style>
</head>

<body>

    <div class="overlay" id="sim-overlay">
        <div style="width:450px">
            <h3 id="sim-title" style="font-family:'DM Serif Display'; font-size:28px;"></h3>
            <div class="progress-bar" style="margin: 24px auto;">
                <div class="progress-fill" id="sim-progress"></div>
            </div>
            <p id="sim-status" style="color:var(--muted); font-size:13px; font-family:'IBM Plex Mono';"></p>
        </div>
    </div>

    <!-- MASTER BRIEFING DASHBOARD -->
    <div id="final-report">
        <div style="max-width: 1200px; margin: 0 auto;">
            <div
                style="border-bottom: 1px solid var(--border); padding-bottom: 32px; margin-bottom: 32px; display: flex; justify-content: space-between; align-items: flex-end;">
                <div>
                    <h1 style="font-family:'DM Serif Display'; font-size:48px;">Executive Market Insights Dashboard</h1>
                    <p style="color:var(--muted); font-weight:700; letter-spacing:2px; text-transform:uppercase;"
                        id="rep-mode-title">Hackfest Edition ‚Äî High-Fidelity Logic</p>
                </div>
                <button class="btn btn-secondary" onclick="location.reload()">New Simulation Cycle</button>
            </div>

            <div class="grid grid-3">
                <div class="card">
                    <div class="card-label">Market Adoption index</div>
                    <div class="card-val" id="rep-pre">--</div>
                </div>
                <div class="card">
                    <div class="card-label">Resilience to Drift</div>
                    <div class="card-val" id="rep-post">--</div>
                </div>
                <div class="card">
                    <div class="card-label" style="color:var(--gold)">Target Opportunity cluster</div>
                    <div class="card-val" id="rep-winner" style="font-size:18px; color:var(--accent3)">--</div>
                </div>
            </div>

            <!-- Dashboard Charts Section -->
            <div style="display:grid; grid-template-columns: 1.5fr 1fr; gap:32px; margin-top:24px;">
                <div class="card">
                    <div class="card-label">Cluster Sentiment Analysis (Post-Drift)</div>
                    <div class="dashboard-chart" id="dashboard-chart"></div>
                    <p style="margin-top:16px; font-size:11px; color:var(--muted);">The blue bar highlights your
                        <b>Target Acquisition Segment</b> (highest post-drift affinity).
                    </p>
                </div>

                <div class="card">
                    <div class="card-label" id="sample-label">Representative Audience Sample (Cultural Stratification)
                    </div>
                    <table class="leaderboard">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Demographics (Age/Gen/State)</th>
                                <th>Archetype</th>
                                <th>Brief</th>
                                <th>Intent</th>
                            </tr>
                        </thead>
                        <tbody id="rep-sample-body"></tbody>
                    </table>
                </div>
            </div>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:32px; margin-top:32px;">
                <div class="opp-card">
                    <div class="card-label" style="color:var(--gold)">Improvement Roadmap ‚Äî Voice of the Customer</div>
                    <h4 style="font-family:'DM Serif Display'; font-size:20px; margin: 8px 0;" id="rep-opp-title">
                        High-Friction enthusiast</h4>
                    <p id="rep-opp-verbatim" class="verbatim-text"></p>
                </div>

                <div class="card">
                    <div class="card-label">Macro-Resilience Summary</div>
                    <p style="color:var(--muted); margin-top:12px; line-height:1.6; font-size:14px;" id="rep-rationale">
                    </p>
                </div>
            </div>
        </div>
    </div>

    <header class="wizard-header">
        <div class="logo">
            <h1>SynthIQ</h1>
        </div>
        <div class="step-indicator">
            <div class="step active" id="st-1">
                <div class="step-num">1</div>Foundation
            </div>
            <div class="step" id="st-2">
                <div class="step-num">2</div>Simulation
            </div>
            <div class="step" id="st-3">
                <div class="step-num">3</div>Drift
            </div>
            <div class="step" id="st-4">
                <div class="step-num">4</div>Audit
            </div>
            <div class="step" id="st-5">
                <div class="step-num">5</div>Dashboard
            </div>
        </div>
        <div style="font-size:10px; color:var(--muted); font-family:'IBM Plex Mono'">SYNTHIQ_HACK_V12</div>
    </header>

    <main class="viewport">
        <!-- STEP 1: INITIALIZATION -->
        <div id="page-1" class="page active">
            <div class="title-block">
                <h2>Synthetic Methodology</h2>
                <p>Synthesize a high-resolution market grid of 20,000 agents with individual life-markers (Age, Income,
                    Big Five).</p>
            </div>
            <div class="card-label">Simulation Mode</div>
            <div class="mode-selector">
                <div class="mode-btn active" onclick="setMode('acceptance')" id="mode-acceptance">
                    <h4>Product Acceptance</h4>
                    <p>Testing specific product resonance and friction barriers.</p>
                </div>
                <div class="mode-btn" onclick="setMode('ab')" id="mode-ab">
                    <h4>A/B Strategy Testing</h4>
                    <p>Comparing resonance between two strategic marketing vectors.</p>
                </div>
            </div>
            <div class="card" style="margin-bottom:24px;">
                <div class="card-label">Audience Scale</div>
                <div style="display:flex; align-items:center; gap:24px; margin-top:12px;">
                    <input type="range" min="1000" max="50000" step="1000" value="20000" id="pop-slider"
                        oninput="updatePopLabel()" style="flex:1;">
                    <div id="pop-label"
                        style="font-family:'IBM Plex Mono'; font-size:28px; font-weight:800; color:var(--accent); width:150px;">
                        20,000</div>
                </div>
            </div>
            <button class="btn btn-primary" onclick="initAgents()">‚óà CONSTRUCT MARKET DNA</button>
            <div id="res-1" style="display:none; margin-top:24px;">
                <div class="card-label">Audience Grid Census</div>
                <div class="census-track" id="census-track"></div>
                <div id="census-legend"
                    style="display:grid; grid-template-columns:repeat(5, 1fr); gap:12px; font-size:9px; color:var(--muted); margin-top:12px;">
                </div>
            </div>
        </div>

        <!-- STEP 2: RESONANCE -->
        <div id="page-2" class="page">
            <div id="view-acceptance" style="display:none;">
                <div class="title-block">
                    <h2>Product Proposition</h2>
                    <p>Define your product to trigger the semantic resonance engine.</p>
                </div>
                <div class="card">
                    <div class="card-label">Product Context</div><textarea id="product-desc"
                        style="height:120px;">Eco-Tech Student Laptop: ‚Çπ32,999. Recycled aluminum, 18-hr battery, integrated solar charging on lid. Perfect for budget-conscious creators.</textarea>
                </div>
            </div>
            <div id="view-ab" style="display:none;">
                <div class="title-block">
                    <h2>A/B Comparative Simulator</h2>
                    <p>Calculate resonance for two distinct strategic paths.</p>
                </div>
                <div class="grid grid-2">
                    <div class="card">
                        <div class="card-label">Variation A</div><textarea
                            id="desc-a">Status & Luxury: ‚Çπ1,500/mo access fee. VIP event invites and priority concierge service.</textarea>
                    </div>
                    <div class="card">
                        <div class="card-label">Variation B</div><textarea
                            id="desc-b">Utility & Value: ‚Çπ29/day pay-as-you-go. Cancel anytime, focused on student essentials.</textarea>
                    </div>
                </div>
            </div>
            <button class="btn btn-primary" onclick="runSimulation()" style="margin-top:20px;">‚ñ∂ RUN NEURAL
                PROPAGATION</button>
            <div id="res-2" style="display:none; margin-top:24px;">
                <div class="grid grid-2">
                    <div class="card">
                        <div class="card-label" id="res2-label1">Winning Strategy</div>
                        <div class="card-val" id="res2-val1">--</div>
                    </div>
                    <div class="card">
                        <div class="card-label">Market Fit confidence</div>
                        <div class="card-val" id="res2-val2">--</div>
                    </div>
                </div>
                <div class="verbatim-card">
                    <div class="card-label" style="color:var(--accent3)">Hero Persona Verification</div>
                    <p id="hero-verbatim" class="verbatim-text"></p>
                    <div style="display:flex; justify-content:space-between; align-items:flex-end;">
                        <div id="hero-name" class="verbatim-author"></div>
                        <div id="hero-demographics" style="font-size:9px; color:var(--muted); font-weight:700;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- STEP 3: DRIFT -->
        <div id="page-3" class="page">
            <div class="title-block">
                <h2>Inject Environment Drift</h2>
                <p>Observe how macro-economic shocks and unpredictable personal life-events fracture customer intent.
                </p>
            </div>
            <div class="grid grid-2">
                <div class="card">
                    <div class="card-label">Macro Stress Levels</div>
                    <div style="margin-top:20px;">
                        <div style="display:flex; justify-content:space-between; font-size:11px; margin-bottom:8px;">
                            <span>Annual Inflation</span><b id="inf-txt">12%</b>
                        </div>
                        <input type="range" min="0" max="30" value="12" id="inf-input" oninput="updateShockLabels()"
                            style="margin-bottom:20px;">
                        <div style="display:flex; justify-content:space-between; font-size:11px; margin-bottom:8px;">
                            <span>Lending Rates</span><b id="rate-txt">9%</b>
                        </div>
                        <input type="range" min="0" max="20" value="9" id="rate-input" oninput="updateShockLabels()">
                    </div>
                </div>
                <div class="card">
                    <div class="card-label">Neural Drift Log (Individually Tracked)</div>
                    <div class="log-container" id="shock-log"></div>
                </div>
            </div>
            <button class="btn btn-primary" onclick="propagateDrift()">‚ö° START DRIFT ENGINE</button>
        </div>

        <!-- STEP 4: AUDIT -->
        <div id="page-4" class="page">
            <div class="title-block">
                <h2>Resilience Impact Audit</h2>
                <p>Identifying the most loyal target cluster by auditing 20,000 unique intent trajectories.</p>
            </div>
            <div class="grid grid-2">
                <div class="card">
                    <div class="card-label">Individual Intent Fracture (Pre vs Post Drift)</div>
                    <div class="badge-grid">
                        <div class="badge pre">BASE: <span id="hero-pre-val">--</span></div>
                        <div class="badge post">POST: <span id="hero-post-val">--</span></div>
                    </div>
                    <div class="verbatim-card" style="margin-top:16px;">
                        <p id="hero-drift-verbatim" class="verbatim-text"></p>
                        <div style="display:flex; justify-content:space-between; align-items:flex-end;">
                            <div id="hero-drift-name" class="verbatim-author"></div>
                            <div id="hero-drift-demographics"
                                style="font-size:9px; color:var(--muted); font-weight:700;"></div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-label" id="buyer-sample-title">Representative Sample (Cultural Mix)</div>
                    <table class="leaderboard">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Age</th>
                                <th>Gen</th>
                                <th>State</th>
                                <th>Archetype</th>
                                <th>Brief</th>
                                <th>Final Intent</th>
                            </tr>
                        </thead>
                        <tbody id="audit-sample-body"></tbody>
                    </table>
                </div>
            </div>
            <button class="btn btn-primary" onclick="runResilience()">‚ñ∂ GENERATE EXECUTIVE DASHBOARD</button>
        </div>
    </main>

    <footer class="action-footer">
        <button class="btn btn-secondary" onclick="prevStep()" id="btn-back">‚Üê Back</button>
        <div id="status-hint" style="color:var(--muted); font-size:12px;">Phase 1: methodology Construction.</div>
        <button class="btn btn-primary" onclick="nextStep()" id="btn-next">Next Step ‚Üí</button>
    </footer>

    <script>
        const FIRST_NAMES = ["Rajesh", "Sameet", "Aditi", "Vikram", "Tanya", "Pramod", "Neha", "Keshav", "Sanya", "Arjun", "Tushar", "Priya", "Meera", "Anil", "Deepak", "Riya", "Kavya", "Siddharth", "Ishaan", "Zoya"];
        const LAST_NAMES = ["Sharma", "Singh", "Gupta", "Kapoor", "Reddy", "Patel", "Mehra", "Verma", "Iyer", "Nair"];

        const ARCHETYPES = [
            { name: "The Value Dailyists", weight: 0.12, color: '#7c6af7', sensitivity: 1.5, age: 28, income: 45000, phrases: ["Budget-first daily commuter", "Utility-focused student", "Eco-conscious value hunter"] },
            { name: "The Stressed Savers", weight: 0.15, color: '#4f46e5', sensitivity: 1.8, age: 42, income: 35000, phrases: ["Conservative family manager", "Inflation-sensitive saver", "Risk-averse budget balancing"] },
            { name: "The Aspiring Climbers", weight: 0.18, color: '#22d3a5', sensitivity: 1.1, age: 24, income: 60000, phrases: ["Early-career tech enthusiast", "Brand-aware city dweller", "Upwardly mobile professional"] },
            { name: "The Career Minimalists", weight: 0.10, color: '#10b981', sensitivity: 0.9, age: 35, income: 80000, phrases: ["Efficiency-driven worker", "Pragmatic tech adopter", "Low-friction lifestyle seeker"] },
            { name: "The Premium Loyalists", weight: 0.08, color: '#f97316', sensitivity: 0.4, age: 38, income: 150000, phrases: ["Quality-first brand loyalist", "Status-aware tech investor", "Premium experience seeker"] },
            { name: "The Heritage Elite", weight: 0.05, color: '#ea580c', sensitivity: 0.2, age: 55, income: 300000, phrases: ["Legacy asset protector", "Conservative luxury buyer", "Stability-focused decision maker"] },
            { name: "The Budget Cautious", weight: 0.14, color: '#f43f5e', sensitivity: 1.3, age: 31, income: 28000, phrases: ["Cost-sensitive survivor", "Bargain-driven consumer", "Liquidity-focused spender"] },
            { name: "The Risk Averse", weight: 0.10, color: '#e11d48', sensitivity: 1.4, age: 48, income: 55000, phrases: ["Stability-seeking planner", "Known-brand only adopter", "Change-resistant consumer"] },
            { name: "The Power Professionals", weight: 0.05, color: '#ec4899', sensitivity: 0.5, age: 29, income: 180000, phrases: ["High-output city executive", "Cutting-edge tech adopter", "Value-per-hour optimizer"] },
            { name: "The Asset Secure", weight: 0.03, color: '#db2777', sensitivity: 0.3, age: 50, income: 250000, phrases: ["Asset-backed luxury buyer", "Resilient high-net-worth", "Philanthropic trend-setter"] }
        ];

        let agents = [];
        let currentStep = 1;
        let simMode = 'acceptance';
        let stepCompleted = [false, false, false, false, false, false];
        let popSize = 20000;
        let heroAgent = null;
        let targetCluster = "";

        const SHOCK_LIBRARY = [
            { type: "HEALTH EMERGENCY", text: "Sudden medical hospitalization in family. Emergency savings diverted.", drop: 25 },
            { type: "RENTAL SPIKE", text: "Property owner increased rent by 20% overnight. Disposable income crashed.", drop: 15 },
            { type: "JOB RESTRUCTURING", text: "Corporate downsizing announced. Transitioning to survival mode.", drop: 30 },
            { type: "VEHICLE REPAIR", text: "Major mechanical failure in primary transport. High upfront cost.", drop: 12 },
            { type: "FAMILY EVENT", text: "Unplanned social obligation/wedding. Liquidity drained.", drop: 20 }
        ];

        // Cultural Bias Layer - Hofstede India Engine
        const FACTOR_WEIGHTS = { "PDI": 0.20, "IDV": 0.25, "UAI": 0.25, "LTO": 0.20, "IVR": 0.10 };
        const INDIA_BASE = { "PDI": 60, "IDV": 45, "UAI": 42, "LTO": 50, "IVR": 28 };

        const STATE_RULES = {
            "Kerala": [
                { factor: "PDI", delta: -13, reason: "high literacy + egalitarianism" },
                { factor: "IDV", delta: +17, reason: "NRI remittance agency" },
                { factor: "UAI", delta: -10, reason: "ambiguity normalization" },
                { factor: "LTO", delta: +15, reason: "generational edu-investment" },
                { factor: "IVR", delta: +7, reason: "Gulf lifestyle exposure" }
            ],
            "Gujarat": [
                { factor: "IDV", delta: +20, reason: "entrepreneurial DNA" },
                { factor: "UAI", delta: -12, reason: "diamond/mercantile risk-comfort" },
                { factor: "LTO", delta: +20, reason: "long-horizon wealth accumulation" },
                { factor: "IVR", delta: -10, reason: "austerity culture" }
            ],
            "Goa": [
                { factor: "PDI", delta: -8, reason: "Portuguese legacy" },
                { factor: "IDV", delta: +20, reason: "tourism individual initiative" },
                { factor: "LTO", delta: -8, reason: "present-focused leisure" },
                { factor: "IVR", delta: +44, reason: "highest indulgence index" }
            ],
            "Maharashtra": [
                { factor: "IDV", delta: +10, reason: "urban competitive center" },
                { factor: "PDI", delta: +5, reason: "corporate hierarchy" },
                { factor: "IVR", delta: +15, reason: "cosmopolitan spending" }
            ],
            "Tamil Nadu": [
                { factor: "LTO", delta: +18, reason: "conservative asset building" },
                { factor: "UAI", delta: +10, reason: "process-driven discipline" },
                { factor: "PDI", delta: +5, reason: "structured institutionalism" }
            ],
            "Punjab": [
                { factor: "IVR", delta: +25, reason: "agrarian prosperity + hospitality" },
                { factor: "IDV", delta: +10, reason: "pioneer/migrant spirit" },
                { factor: "UAI", delta: -5, reason: "robust risk appetite" }
            ],
            "West Bengal": [
                { factor: "IDV", delta: -10, reason: "collectivist intellectualism" },
                { factor: "PDI", delta: -5, reason: "unionized egalitarian roots" },
                { factor: "LTO", delta: +10, reason: "cultural preservation" }
            ],
            "Karnataka": [
                { factor: "IDV", delta: +15, reason: "tech-driven meritocracy" },
                { factor: "PDI", delta: -5, reason: "start-up flattening" },
                { factor: "IVR", delta: +10, reason: "entertainment-first city culture" }
            ]
        };

        const STATES = Object.keys(STATE_RULES);
        const GENDERS = ["Male", "Female"];

        function setMode(mode) {
            simMode = mode;
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('mode-' + mode).classList.add('active');
        }

        function updatePopLabel() {
            popSize = parseInt(document.getElementById('pop-slider').value);
            document.getElementById('pop-label').innerText = popSize.toLocaleString();
        }

        function updateShockLabels() {
            document.getElementById('inf-txt').innerText = document.getElementById('inf-input').value + "%";
            document.getElementById('rate-txt').innerText = document.getElementById('rate-input').value + "%";
        }

        function initAgents() {
            showOverlay("Cloning Population DNA...", ["Constructing 20,000 Neural Nodes...", "Mapping Psychological Profiles...", "Seeding Demographic Variance..."], () => {
                agents = [];
                const track = document.getElementById('census-track');
                const legend = document.getElementById('census-legend');
                track.innerHTML = ''; legend.innerHTML = '';

                ARCHETYPES.forEach(a => {
                    const count = Math.floor(popSize * a.weight);
                    track.innerHTML += `<div class="census-seg" style="width:${a.weight * 100}%; background:${a.color}"></div>`;
                    legend.innerHTML += `<div><span style="color:${a.color}">‚óè</span> <b>${a.name}</b></div>`;
                    for (let i = 0; i < count; i++) {
                        const state = STATES[Math.floor(Math.random() * STATES.length)];
                        const gender = GENDERS[Math.floor(Math.random() * GENDERS.length)];
                        const bio = a.phrases[Math.floor(Math.random() * a.phrases.length)];

                        // Build individual Hofstede profile
                        let hProf = { ...INDIA_BASE };
                        if (STATE_RULES[state]) {
                            STATE_RULES[state].forEach(rule => {
                                hProf[rule.factor] = Math.max(10, Math.min(95, hProf[rule.factor] + rule.delta));
                            });
                        }

                        agents.push({
                            name: FIRST_NAMES[Math.floor(Math.random() * FIRST_NAMES.length)] + " " + LAST_NAMES[Math.floor(Math.random() * LAST_NAMES.length)],
                            type: a.name, color: a.color, sens: a.sensitivity,
                            age: a.age + Math.floor(Math.random() * 15),
                            gender: gender, state: state, hProf: hProf,
                            income: a.income * (0.8 + Math.random() * 0.4),
                            base: 0, current: 0,
                            bio: bio
                        });
                    }
                });
                heroAgent = agents[Math.floor(Math.random() * agents.length)];
                document.getElementById('res-1').style.display = 'block';
                document.getElementById('view-acceptance').style.display = (simMode === 'acceptance' ? 'block' : 'none');
                document.getElementById('view-ab').style.display = (simMode === 'ab' ? 'block' : 'none');
                stepCompleted[1] = true;
                notify("DNA Construct Active.");
            });
        }

        function runSimulation() {
            showOverlay("Neural Simulation...", ["Analyzing Semantic Resonance...", "Mapping Individual Intent...", "Finalizing Baseline Fit..."], () => {
                const txtA = document.getElementById('desc-a').value.toLowerCase();
                const txtB = document.getElementById('desc-b').value.toLowerCase();
                const prod = document.getElementById('product-desc').value.toLowerCase();

                function score(txt, a) {
                    let s = 50;
                    if ((txt.includes('daily') || txt.includes('utility') || txt.includes('eco')) && a.income < 70000) s += 15;
                    if ((txt.includes('premium') || txt.includes('luxury')) && a.income > 150000) s += 20;

                    // Cultural Fit Logic
                    let cFit = 0;
                    const p = a.hProf;

                    // High PDI (Hierarchy fit) - weight 0.20
                    if (txt.includes('loyalty') || txt.includes('established') || txt.includes('status')) cFit += (p.PDI / 100) * 10;

                    // IDV (Individuality vs Agreeableness) - weight 0.25
                    if (txt.includes('custom') || txt.includes('unique')) cFit += (p.IDV / 100) * 12;
                    else cFit += ((100 - p.IDV) / 100) * 8; // Collectivist fit

                    // UAI (Risk tolerance) - weight 0.25
                    if (txt.includes('secure') || txt.includes('guarantee') || txt.includes('warranty')) cFit += (p.UAI / 100) * 15;
                    else if (txt.includes('innovative') || txt.includes('experimental')) cFit += ((100 - p.UAI) / 100) * 15;

                    // LTO (Investment horizon) - weight 0.20
                    if (txt.includes('longevity') || txt.includes('durable')) cFit += (p.LTO / 100) * 12;

                    // IVR (Indulgence weight) - 0.10
                    if (txt.includes('fun') || txt.includes('joy') || txt.includes('gift')) cFit += (p.IVR / 100) * 10;

                    return Math.min(100, s + cFit + (Math.random() * 15));
                }

                if (simMode === 'ab') {
                    let totalA = 0, totalB = 0;
                    agents.forEach(a => { totalA += score(txtA, a); totalB += score(txtB, a); });
                    const winA = totalA > totalB;
                    document.getElementById('res2-val1').innerText = winA ? "Strategy A" : "Strategy B";
                    document.getElementById('res2-val2').innerText = ((winA ? totalA : totalB) / popSize).toFixed(0) + "% Fit";
                    agents.forEach(a => a.base = winA ? score(txtA, a) : score(txtB, a));
                } else {
                    document.getElementById('res2-val1').innerText = "High Interest";
                    let sum = 0;
                    agents.forEach(a => { a.base = score(prod, a); sum += a.base; });
                    document.getElementById('res2-val2').innerText = (sum / popSize).toFixed(0) + "% Intent";
                }

                agents.forEach(a => a.current = a.base);
                document.getElementById('hero-name').innerText = heroAgent.name + " (" + heroAgent.type + ")";
                document.getElementById('hero-demographics').innerText = `${heroAgent.age}yr | ${heroAgent.gender} | ${heroAgent.state}`;
                document.getElementById('hero-verbatim').innerText = `"Considering my current lifestyle, I'm ${heroAgent.base.toFixed(0)}% certain about this. It seems to resonate with my priorities."`;
                document.getElementById('res-2').style.display = 'block';
                stepCompleted[2] = true;
                notify("Baseline Intelligence Logged.");
            });
        }

        function propagateDrift() {
            const inf = parseInt(document.getElementById('inf-input').value);
            const rate = parseInt(document.getElementById('rate-input').value);
            showOverlay("Environment Drift...", ["Inducing Macro Shocks...", "Spawning Random Life Events...", "Tracing Intent Fracture..."], () => {
                const log = document.getElementById('shock-log'); log.innerHTML = '';

                // Track counts for balanced logging (10 each)
                let counts = { macro: 0, personal: 0, cultural: 0 };
                const logLimit = 10;

                agents.forEach((a, i) => {
                    const macroDrop = (inf / 100 + rate / 100) * a.sens * 12;
                    let psDrop = 0;
                    let culDrop = 0;

                    // 1. Macromicro Shock (Indices for 10 guaranteed logs)
                    if (counts.macro < logLimit && i % Math.floor(popSize / 15) === 0) {
                        log.innerHTML += `<div class="log-line shock">‚óà [MACRO SHOCK] <b>${a.name}</b> intent eroded: -${macroDrop.toFixed(0)}% <small>State: ${a.state} | Rationale: High inflation sensitivity + income strain.</small></div>`;
                        counts.macro++;
                    }

                    // 2. Personal Shock (Random Life Event)
                    const hasPersonal = Math.random() < 0.05;
                    if (hasPersonal) {
                        const shock = SHOCK_LIBRARY[Math.floor(Math.random() * SHOCK_LIBRARY.length)];
                        psDrop = shock.drop;
                        if (counts.personal < logLimit) {
                            log.innerHTML += `<div class="log-line personal">‚ö° [${shock.type}] <b>${a.name}</b> intent crashed: -${psDrop.toFixed(0)}% <small>${shock.text}</small></div>`;
                            counts.personal++;
                        }
                    }

                    // 3. Cultural Bias/Friction
                    // Thresholds adjusted: PDI > 60 (Hierarchy sensitivity) or UAI > 50 (Risk sensitivity)
                    const culturalFriction = (a.hProf.PDI > 60 && inf > 6) || (a.hProf.UAI > 50 && rate > 4);
                    if (culturalFriction) {
                        culDrop = 12 + Math.random() * 8;
                        if (counts.cultural < logLimit) {
                            const reason = a.hProf.PDI > 60 ? "Bureaucratic friction: Regional PDI hierarchy resists market shifts" : "Uncertainty avoidance (UAI): Local risk culture triggers panic divestment";
                            log.innerHTML += `<div class="log-line cultural">üïâ [CULTURAL FRICTION] <b>${a.name}</b> (${a.state}): -${culDrop.toFixed(0)}% <small>Rationale: ${reason}.</small></div>`;
                            counts.cultural++;
                        }
                    }

                    a.current = Math.max(0, a.current - macroDrop - psDrop - culDrop);
                });

                stepCompleted[3] = true;
                notify("Market Fracture Complete. Cultural logs synced.");
            });
        }

        function runResilience() {
            showOverlay("Calibrating Dashboard...", ["Filtering Buyer Clusters...", "Stratifying Representative Sample...", "Drawing Sentiment Curves..."], () => {
                // Find target cluster
                const clusterAvg = {};
                ARCHETYPES.forEach(arch => {
                    const group = agents.filter(a => a.type === arch.name);
                    clusterAvg[arch.name] = group.reduce((s, a) => s + a.current, 0) / (group.length || 1);
                });
                targetCluster = Object.keys(clusterAvg).reduce((a, b) => clusterAvg[a] > clusterAvg[b] ? a : b);

                // Populate Hero Comparison
                document.getElementById('hero-pre-val').innerText = heroAgent.base.toFixed(0) + "%";
                document.getElementById('hero-post-val').innerText = heroAgent.current.toFixed(0) + "%";
                document.getElementById('hero-drift-name').innerText = heroAgent.name;
                document.getElementById('hero-drift-demographics').innerText = `${heroAgent.age}yr | ${heroAgent.gender} | ${heroAgent.state}`;
                document.getElementById('hero-drift-verbatim').innerText = `"Drift has changed my outlook. I've gone from ${heroAgent.base.toFixed(0)}% to ${heroAgent.current.toFixed(0)}% because I've had to reprioritize my survival budget."`;

                // Stratified Sample (Random 10 with mixed intent)
                const buyerGroup = agents.filter(a => a.type === targetCluster);

                function getStratifiedMix(group) {
                    const high = group.filter(p => p.current >= 70);
                    const med = group.filter(p => p.current >= 40 && p.current < 70);
                    const low = group.filter(p => p.current < 40);
                    const pick = (arr, n) => [...arr].sort(() => 0.5 - Math.random()).slice(0, n);

                    let mix = [...pick(high, 3), ...pick(med, 4), ...pick(low, 3)];

                    while (mix.length < 10 && group.length > mix.length) {
                        const remaining = group.filter(p => !mix.includes(p));
                        mix.push(remaining[Math.floor(Math.random() * remaining.length)]);
                    }
                    return mix.sort(() => 0.5 - Math.random());
                }

                const mixed10 = getStratifiedMix(buyerGroup);
                const body = document.getElementById('audit-sample-body'); body.innerHTML = '';
                mixed10.forEach(p => {
                    const cls = p.current <= 50 ? 'low' : (p.current <= 75 ? 'mid' : 'high');
                    body.innerHTML += `<tr>
                        <td>${p.name}</td>
                        <td>${p.age}</td>
                        <td>${p.gender[0]}</td>
                        <td>${p.state}</td>
                        <td>${p.type}</td>
                        <td>${p.bio}</td>
                        <td class="score ${cls}">${p.current.toFixed(0)}%</td>
                    </tr>`;
                });

                document.getElementById('buyer-sample-title').innerText = `Stratified Representative Sample (${targetCluster})`;
                stepCompleted[4] = true;
                notify("Dashboard Calibrated.");
            });
        }

        function generateFinalReport() {
            document.getElementById('final-report').style.display = 'block';
            const avgPre = agents.reduce((s, a) => s + a.base, 0) / popSize;
            const avgPost = agents.reduce((s, a) => s + a.current, 0) / popSize;

            document.getElementById('rep-pre').innerText = avgPre.toFixed(0) + "%";
            document.getElementById('rep-post').innerText = avgPost.toFixed(0) + "%";
            document.getElementById('rep-winner').innerText = targetCluster;

            // Generate Dashboard Chart
            const chart = document.getElementById('dashboard-chart'); chart.innerHTML = '';
            ARCHETYPES.forEach(arch => {
                const group = agents.filter(a => a.type === arch.name);
                const avg = group.reduce((s, a) => s + a.current, 0) / (group.length || 1);
                const isWinner = arch.name === targetCluster;
                chart.innerHTML += `
                    <div class="chart-bar-wrapper">
                        <div class="chart-bar ${isWinner ? 'winner' : ''}" style="height:${avg * 1.5}px" data-val="${avg.toFixed(0)}"></div>
                        <div class="chart-label">${arch.name.split(' ')[1]}</div>
                    </div>
                `;
            });

            // Representative Report Sample (New Stratified Pull)
            const repBody = document.getElementById('rep-sample-body'); repBody.innerHTML = '';
            const buyerGroup = agents.filter(a => a.type === targetCluster);

            const fresh10 = (function (group) {
                const high = group.filter(p => p.current >= 70);
                const med = group.filter(p => p.current >= 40 && p.current < 70);
                const low = group.filter(p => p.current < 40);
                const pick = (arr, n) => [...arr].sort(() => 0.5 - Math.random()).slice(0, n);
                let mix = [...pick(high, 3), ...pick(med, 4), ...pick(low, 3)];
                while (mix.length < 10 && group.length > mix.length) {
                    const remaining = group.filter(p => !mix.includes(p));
                    mix.push(remaining[Math.floor(Math.random() * remaining.length)]);
                }
                return mix.sort(() => 0.5 - Math.random());
            })(buyerGroup);

            fresh10.forEach(p => {
                const tier = p.current >= 70 ? "High" : (p.current >= 40 ? "Mid" : "Low");
                const cls = p.current <= 50 ? 'low' : (p.current <= 75 ? 'mid' : 'high');
                repBody.innerHTML += `<tr>
                    <td><b>${p.name}</b></td>
                    <td>${p.age} / ${p.gender[0]} / ${p.state}</td>
                    <td>${p.type}</td>
                    <td>${p.bio}</td>
                    <td class="score ${cls}">${p.current.toFixed(0)}% <span class="rep-tag">${tier}</span></td>
                </tr>`;
            });

            // Opportunity Machine
            const critic = agents.find(a => a.current > 35 && a.current < 55) || agents[0];
            document.getElementById('rep-opp-verbatim').innerText = `"If you could bundle this with a 0% interest EMI plan or a 'First-Year Resilience' cashback, my current ${critic.current.toFixed(0)}% intent would jump back to 85%. I want to buy, but I need security."`;

            document.getElementById('rep-rationale').innerText = `
                The dashboard audit confirms that while the general population resonance dropped to ${avgPost.toFixed(0)}%, the '${targetCluster}' segment remains extremely resilient.
                Macro-drift sensitivity is highest in 'The Stressed Savers' who hit survival thresholds faster.
                Strategy recommendation: Focus 80% of marketing spend on '${targetCluster}' and implement price-decoupling for other clusters to recover the ${(avgPre - avgPost).toFixed(0)}% loss.
            `;
        }

        function showOverlay(title, steps, callback) {
            const overlay = document.getElementById('sim-overlay');
            const bar = document.getElementById('sim-progress');
            const status = document.getElementById('sim-status');
            overlay.style.display = 'flex'; document.getElementById('sim-title').innerText = title;
            let p = 0;
            const ival = setInterval(() => {
                p += 5; bar.style.width = p + "%";
                if (p % 20 === 0) status.innerText = steps[Math.floor(p / 25)] || steps[steps.length - 1];
                if (p >= 100) { clearInterval(ival); setTimeout(() => { overlay.style.display = 'none'; callback(); }, 500); }
            }, 60);
        }

        function nextStep() {
            if (!stepCompleted[currentStep]) { notify("Execute current phase to unlock."); return; }
            if (currentStep === 4) { generateFinalReport(); return; }
            document.getElementById('page-' + currentStep).classList.remove('active');
            document.getElementById('st-' + currentStep).classList.remove('active');
            document.getElementById('st-' + currentStep).classList.add('completed');
            currentStep++;
            document.getElementById('page-' + currentStep).classList.add('active');
            document.getElementById('st-' + currentStep).classList.add('active');
            updateFooter();
        }

        function prevStep() {
            if (currentStep > 1) {
                document.getElementById('page-' + currentStep).classList.remove('active');
                document.getElementById('st-' + currentStep).classList.remove('active');
                currentStep--;
                document.getElementById('st-' + currentStep).classList.add('active');
                document.getElementById('st-' + currentStep).classList.remove('completed');
                document.getElementById('page-' + currentStep).classList.add('active');
                updateFooter();
            }
        }

        function updateFooter() {
            const h = ["", "Set Simulation methodology.", "neural resonance Calculation.", "market drift Induction.", "high-Resolution resilience Audit.", "View Executive Dashboard."];
            document.getElementById('status-hint').innerText = "Phase " + currentStep + " ‚Äî " + h[currentStep];
            document.getElementById('btn-back').disabled = (currentStep === 1);
            document.getElementById('btn-next').innerText = (currentStep === 4) ? "GENERATE MASTER DASHBOARD ‚óà" : "Next Step ‚Üí";
        }

        function notify(msg) {
            const t = document.createElement('div'); t.style = "position:fixed; bottom:100px; left:50%; transform:translateX(-50%); background:var(--accent); color:#fff; padding:10px 25px; border-radius:30px; font-size:12px; font-weight:800; z-index:99999; box-shadow:0 10px 30px rgba(0,0,0,0.5); border:1px solid rgba(255,255,255,0.2);";
            t.innerText = "‚óà " + msg; document.body.appendChild(t); setTimeout(() => t.remove(), 3000);
        }

        updatePopLabel();
        updateFooter();
    </script>
</body>

</html>